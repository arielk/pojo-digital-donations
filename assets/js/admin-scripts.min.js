jQuery(document).ready(function(e){var t={init:function(){this.add();this.move();this.remove();this.type();this.prices();this.files();this.updatePrices()},clone_repeatable:function(t){clone=t.clone();clone.find("select").each(function(){e(this).val(t.find('select[name="'+e(this).attr("name")+'"]').val())});var n=t.parent().find("tr").length-1;clone.removeClass("pdd_add_blank");clone.find("td input, td select").val("");clone.find("input, select").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(n)+"]");e(this).attr("name",t).attr("id",t)});return clone},add:function(){e("body").on("click",".submit .pdd_add_repeatable",function(n){n.preventDefault();var r=e(this),i=r.parent().parent().prev("tr"),s=t.clone_repeatable(i);s.insertAfter(i)})},move:function(){},remove:function(){e("body").on("click",".pdd_remove_repeatable",function(t){t.preventDefault();var n=e(this).parent().parent("tr"),r=n.parent().find("tr").length-1,i=e(this).data("type"),s="tr.pdd_repeatable_"+i+"s";e(".pdd_repeatable_condition_field option[value="+n.index()+"]").remove();if(r>1){e("input, select",n).val("");n.fadeOut("fast").remove()}else{switch(i){case"price":alert(pdd_vars.one_price_min);break;case"file":alert(pdd_vars.one_file_min);break;default:alert(pdd_vars.one_field_min);break}}e(s).each(function(t){e(this).find("input, select").each(function(){var n=e(this).attr("name");n=n.replace(/\[(\d+)\]/,"["+t+"]");e(this).attr("name",n).attr("id",n)})})})},type:function(){e("body").on("change","#_pdd_product_type",function(t){if("bundle"===e(this).val()){e("#pdd_products").show();e("#pdd_download_files").hide();e("#pdd_download_limit_wrap").hide()}else{e("#pdd_products").hide();e("#pdd_download_files").show();e("#pdd_download_limit_wrap").show()}})},prices:function(){e("body").on("change","#pdd_variable_pricing",function(t){e(".pdd_pricing_fields,.pdd_repeatable_table .pricing").toggle()})},files:function(){if(typeof wp==="undefined"||"1"!==pdd_vars.new_media_ui){if(e(".pdd_upload_file_button").length>0){window.formfield="";e("body").on("click",".pdd_upload_file_button",function(t){t.preventDefault();window.formfield=e(this).parent().prev();window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(pdd_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2e3);if(pdd_vars.post_id!=null){var n="post_id="+pdd_vars.post_id+"&"}tb_show(pdd_vars.add_new_download,"media-upload.php?"+n+"TB_iframe=true")});window.pdd_send_to_editor=window.send_to_editor;window.send_to_editor=function(t){if(window.formfield){imgurl=e("a","<div>"+t+"</div>").attr("href");window.formfield.val(imgurl);window.clearInterval(window.tbframe_interval);tb_remove()}else{window.pdd_send_to_editor(t)}window.send_to_editor=window.pdd_send_to_editor;window.formfield="";window.imagefield=false}}}else{var n;window.formfield="";e("body").on("click",".pdd_upload_file_button",function(r){r.preventDefault();var i=e(this);window.formfield=e(this).closest(".pdd_repeatable_upload_wrapper");if(n){n.open();return}n=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:i.data("uploader_title"),button:{text:i.data("uploader_button_text")},multiple:e(this).data("multiple")=="0"?false:true});n.on("menu:render:default",function(e){var t={};e.unset("library-separator");e.unset("gallery");e.unset("featured-image");e.unset("embed");e.set(t)});n.on("insert",function(){var e=n.state().get("selection");e.each(function(e,n){e=e.toJSON();if(0===n){window.formfield.find(".pdd_repeatable_attachment_id_field").val(e.id);window.formfield.find(".pdd_repeatable_upload_field").val(e.url);window.formfield.find(".pdd_repeatable_name_field").val(e.title)}else{var r=window.formfield,i=t.clone_repeatable(r);i.find(".pdd_repeatable_attachment_id_field").val(e.id);i.find(".pdd_repeatable_upload_field").val(e.url);if(e.title.length>0){i.find(".pdd_repeatable_name_field").val(e.title)}else{i.find(".pdd_repeatable_name_field").val(e.filename)}i.insertAfter(r)}})});n.open()});var n;window.formfield=""}},updatePrices:function(){e("#pdd_price_fields").on("keyup",".pdd_variable_prices_name",function(){var t=e(this).parents("tr").index(),n=e(this).val(),r=e(".pdd_repeatable_condition_field option[value="+t+"]");if(r.length>0){r.text(n)}else{e(".pdd_repeatable_condition_field").append(e("<option></option>").attr("value",t).text(n))}})}};t.init();if(e(".pdd_datepicker").length>0){var n="mm/dd/yy";e(".pdd_datepicker").datepicker({dateFormat:n})}var r={init:function(){this.edit_address();this.remove_download();this.add_download();this.recalculate_total();this.variable_prices_check();this.add_note();this.remove_note();this.resend_receipt();this.copy_download_link()},edit_address:function(){e('select[name="pdd-payment-address[0][country]"]').change(function(){var t=e(this);data={action:"pdd_get_shop_states",country:t.val(),field_name:"pdd-payment-address[0][state]"};e.post(ajaxurl,data,function(t){if("nostates"==t){e("#pdd-order-address-state-wrap select, #pdd-order-address-state-wrap input").replaceWith('<input type="text" name="pdd-payment-address[0][state]" value="" class="pdd-edit-toggles medium-text"/>')}else{e("#pdd-order-address-state-wrap select, #pdd-order-address-state-wrap input").replaceWith(t)}});return false})},remove_download:function(){e("#pdd-purchased-files").on("click",".pdd-order-remove-download",function(){if(confirm(pdd_vars.delete_payment_download)){e(this).parent().parent().parent().remove();e("#pdd-payment-downloads-changed").val(1);e(".pdd-order-payment-recalc-totals").show()}return false})},add_download:function(){e("#pdd-purchased-files").on("click","#pdd-order-add-download",function(t){t.preventDefault();var n=e("#pdd_order_download_select").val();var r=e(".chosen-single span").text();var i=e("#pdd-order-download-amount").val();var s=e(".pdd_price_options_select option:selected").val();var o=e(".pdd_price_options_select option:selected").text();var u=e("#pdd-order-download-quantity").val();if(n<1){return false}if(!i){i="0.00"}var a=i+pdd_vars.currency_sign;if("before"===pdd_vars.currency_pos){a=pdd_vars.currency_sign+i}if(o){r=r+" - "+o}var f=e("#pdd-purchased-files div.row").length;var l=e("#pdd-purchased-files div.row:last").clone();l.find(".download span").html('<a href="post.php?post='+n+'&action=edit"></a>');l.find(".download span a").text(r);l.find(".price").text(a);l.find(".quantity span").text(u);l.find("input.pdd-payment-details-download-id").val(n);l.find("input.pdd-payment-details-download-price-id").val(s);l.find("input.pdd-payment-details-download-amount").val(i);l.find("input.pdd-payment-details-download-quantity").val(u);l.find("input").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(f)+"]");e(this).attr("name",t).attr("id",t)});e("#pdd-payment-downloads-changed").val(1);e(l).insertAfter("#pdd-purchased-files div.row:last");e(".pdd-order-payment-recalc-totals").show()})},recalculate_total:function(){e("#pdd-order-recalc-total").on("click",function(t){t.preventDefault();var n=0;if(e("#pdd-purchased-files .row .pdd-payment-details-download-amount").length){e("#pdd-purchased-files .row .pdd-payment-details-download-amount").each(function(){var t=e(this).next().val();if(t){n+=parseFloat(e(this).val())*parseInt(t)}else{n+=parseFloat(e(this).val())}})}if(e(".pdd-payment-fees").length){e(".pdd-payment-fees span.fee-amount").each(function(){n+=parseFloat(e(this).data("fee"))})}e("input[name=pdd-payment-total]").val(n)})},variable_prices_check:function(){e("#pdd-purchased-files").on("change","select#pdd_order_download_select",function(){var t=e(this),n=t.val();if(parseInt(n)>0){var r={action:"pdd_check_for_download_price_variations",download_id:n};e.ajax({type:"POST",data:r,url:ajaxurl,success:function(n){e(".pdd_price_options_select").remove();e(n).insertAfter(t.next())}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}})}})},add_note:function(){e("#pdd-add-payment-note").on("click",function(t){t.preventDefault();var n={action:"pdd_insert_payment_note",payment_id:e(this).data("payment-id"),note:e("#pdd-payment-note").val()};if(n.note){e.ajax({type:"POST",data:n,url:ajaxurl,success:function(t){e("#pdd-payment-notes-inner").append(t);e(".pdd-no-payment-notes").hide();e("#pdd-payment-note").val("")}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}})}else{var r=e("#pdd-payment-note").css("border-color");e("#pdd-payment-note").css("border-color","red");setTimeout(function(){e("#pdd-payment-note").css("border-color",r)},500)}})},remove_note:function(){e("body").on("click",".pdd-delete-payment-note",function(t){t.preventDefault();if(confirm(pdd_vars.delete_payment_note)){var n={action:"pdd_delete_payment_note",payment_id:e(this).data("payment-id"),note_id:e(this).data("note-id")};e.ajax({type:"POST",data:n,url:ajaxurl,success:function(t){e("#pdd-payment-note-"+n.note_id).remove();if(!e(".pdd-payment-note").length){e(".pdd-no-payment-notes").show()}return false}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}});return true}})},resend_receipt:function(){e("body").on("click","#pdd-resend-receipt",function(e){return confirm(pdd_vars.resend_receipt)})},copy_download_link:function(){e("body").on("click",".pdd-copy-download-link",function(t){t.preventDefault();var n=e(this);var r={action:"pdd_get_file_download_link",payment_id:e('input[name="pdd_payment_id"]').val(),download_id:n.data("download-id"),price_id:n.data("price-id")};e.ajax({type:"POST",data:r,url:ajaxurl,success:function(t){e("#pdd-download-link").dialog({width:400}).html('<textarea rows="10" cols="40" id="pdd-download-link-textarea">'+t+"</textarea>");e("#pdd-download-link-textarea").focus().select();return false}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}})})}};r.init();var i={init:function(){this.type_select();this.product_requirements()},type_select:function(){e("#pdd-edit-discount #pdd-type, #pdd-add-discount #pdd-type").change(function(){e(".pdd-amount-description").toggle()})},product_requirements:function(){e("#products").change(function(){if(e(this).val()){e("#pdd-discount-product-conditions").show()}else{e("#pdd-discount-product-conditions").hide()}})}};i.init();var s={init:function(){this.date_options();this.customers_export()},date_options:function(){e("#pdd-graphs-date-options").change(function(){var t=e(this);if("other"===t.val()){e("#pdd-date-range-options").show()}else{e("#pdd-date-range-options").hide()}})},customers_export:function(){e("#pdd_customer_export_download").change(function(){var t=e(this),n=e("option:selected",t).val();if("0"===t.val()){e("#pdd_customer_export_option").show()}else{e("#pdd_customer_export_option").hide()}if(parseInt(n)!=0){var r={action:"pdd_check_for_download_price_variations",download_id:n};e.post(ajaxurl,r,function(n){e(".pdd_price_options_select").remove();t.after(n)})}else{e(".pdd_price_options_select").remove()}})}};s.init();var o={init:function(){this.general();this.taxes();this.emails();this.misc()},general:function(){if(e(".pdd-color-picker").length){e(".pdd-color-picker").wpColorPicker()}if(typeof wp==="undefined"||"1"!==pdd_vars.new_media_ui){if(e(".pdd_settings_upload_button").length>0){window.formfield="";e("body").on("click",".pdd_settings_upload_button",function(t){t.preventDefault();window.formfield=e(this).parent().prev();window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(pdd_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2e3);tb_show(pdd_vars.add_new_download,"media-upload.php?TB_iframe=true")});window.pdd_send_to_editor=window.send_to_editor;window.send_to_editor=function(t){if(window.formfield){imgurl=e("a","<div>"+t+"</div>").attr("href");window.formfield.val(imgurl);window.clearInterval(window.tbframe_interval);tb_remove()}else{window.pdd_send_to_editor(t)}window.send_to_editor=window.pdd_send_to_editor;window.formfield="";window.imagefield=false}}}else{var t;window.formfield="";e("body").on("click",".pdd_settings_upload_button",function(n){n.preventDefault();var r=e(this);window.formfield=e(this).parent().prev();if(t){t.open();return}t=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:r.data("uploader_title"),button:{text:r.data("uploader_button_text")},multiple:false});t.on("menu:render:default",function(e){var t={};e.unset("library-separator");e.unset("gallery");e.unset("featured-image");e.unset("embed");e.set(t)});t.on("insert",function(){var e=t.state().get("selection");e.each(function(e,t){e=e.toJSON();window.formfield.val(e.url)})});t.open()});var t;window.formfield=""}},taxes:function(){if(e("select.pdd-no-states").length){e("select.pdd-no-states").closest("tr").hide()}e('select[name="pdd_settings[base_country]"]').change(function(){var t=e(this),n=t.closest("tr");data={action:"pdd_get_shop_states",country:e(this).val(),field_name:"pdd_settings[base_state]"};e.post(ajaxurl,data,function(e){if("nostates"==e){n.next().hide()}else{n.next().show();n.next().find("select").replaceWith(e)}});return false});e("body").on("change","#pdd_tax_rates select.pdd-tax-country",function(){var t=e(this);data={action:"pdd_get_shop_states",country:e(this).val(),field_name:t.attr("name").replace("country","state")};e.post(ajaxurl,data,function(e){if("nostates"==e){var n='<input type="text" name="'+data.field_name+'" value=""/>';t.parent().next().find("select").replaceWith(n)}else{t.parent().next().find("input,select").show();t.parent().next().find("input,select").replaceWith(e)}});return false});e("#pdd_add_tax_rate").on("click",function(){var t=e("#pdd_tax_rates tr:last");var n=t.clone();var r=t.parent().find("tr").length;n.find("td input").val("");n.find("input, select").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(r)+"]");e(this).attr("name",t).attr("id",t)});n.insertAfter(t);return false});e("body").on("click","#pdd_tax_rates .pdd_remove_tax_rate",function(){if(confirm(pdd_vars.delete_tax_rate))e(this).closest("tr").remove();return false})},emails:function(){if(e("#email-preview-wrap").length){var t=e("#email-preview");e("#open-email-preview").colorbox({inline:true,href:t,width:"80%",height:"auto"})}},misc:function(){if(e('select[name="pdd_settings[download_method]"]:selected').val()!="direct"){e('select[name="pdd_settings[download_method]"]').parent().parent().next().hide();e('select[name="pdd_settings[download_method]"]').parent().parent().next().find("input").attr("checked",false)}e('select[name="pdd_settings[download_method]"]').on("change",function(){var t=e(this).parent().parent().next();if(e(this).val()=="direct"){t.hide()}else{t.show();t.find("input").attr("checked",false)}})}};o.init();e(".download_page_pdd-payment-history .row-actions .delete a").on("click",function(){if(confirm(pdd_vars.delete_payment)){return true}return false});e("#the-list").on("click",".editinline",function(){inlineEditPost.revert();var t=e(this).closest("tr").attr("id");t=t.replace("post-","");var n=e("#post-"+t);var r=n.find(".column-price .downloadprice-"+t).val();if(r!=e("#post-"+t+".column-price .downloadprice-"+t).val()){e(".regprice","#pdd-download-data").val(r).attr("disabled",false)}else{e(".regprice","#pdd-download-data").val(pdd_vars.quick_edit_warning).attr("disabled","disabled")}});e("body").on("click","#bulk_edit",function(){var t=e("#bulk-edit");var n=new Array;t.find("#bulk-titles").children().each(function(){n.push(e(this).attr("id").replace(/^(ttle)/i,""))});var r=e('#pdd-download-data input[name="_pdd_regprice"]').val();var i={action:"pdd_save_bulk_edit",pdd_bulk_nonce:n,post_ids:n,price:r};e.post(ajaxurl,i)});e(".pdd-select-chosen").chosen({inherit_select_classes:true,placeholder_text_single:pdd_vars.one_option,placeholder_text_multiple:pdd_vars.one_or_more_option});var u;var a=342;e(".pdd-select.chosen-container .chosen-search input, .pdd-select.chosen-container .search-field input").keyup(function(t){var n=e(this).val(),r=e(this).closest(".pdd-select-chosen");var i=r.attr("id").replace("_chosen","");var s=t.which;if(n.length<=3||t.which==16||t.which==13||t.which==91||t.which==17||t.which==37||t.which==38||t.which==39||t.which==40){return}clearTimeout(u);u=setTimeout(function(){e.ajax({type:"GET",url:ajaxurl,data:{action:"pdd_download_search",s:n},dataType:"json",beforeSend:function(){e("ul.chosen-results").empty()},success:function(t){e("#"+i+" option:not(:selected)").remove();e.each(t,function(t,n){if(!e("#"+i+' option[value="'+n.id+'"]').length){e("#"+i).prepend('<option value="'+n.id+'">'+n.name+"</option>")}});e(".pdd-select-chosen").trigger("chosen:updated");e("#"+i).next().find("input").val(n)}}).fail(function(e){if(window.console&&window.console.log){console.log(data)}}).done(function(e){})},a)});e("#post").on("click",".pdd-thickbox",function(){e(".pdd-select-chosen","#choose-download").css("width","100%")});var f={init:function(){this.revoke_api_key();this.regenerate_api_key()},revoke_api_key:function(){e("body").on("click",".pdd-revoke-api-key",function(e){return confirm(pdd_vars.revoke_api_key)})},regenerate_api_key:function(){e("body").on("click",".pdd-regenerate-api-key",function(e){return confirm(pdd_vars.regenerate_api_key)})}};f.init();e(".pdd-ajax-user-search").keyup(function(){var t=e(this).val();e(".pdd-ajax").show();data={action:"pdd_search_users",user_name:t};document.body.style.cursor="wait";e.ajax({type:"POST",data:data,dataType:"json",url:ajaxurl,success:function(t){e(".pdd-ajax").hide();e(".pdd_user_search_results").html("");e(t.results).appendTo(".pdd_user_search_results");document.body.style.cursor="default"}})});e("body").on("click.pddSelectUser",".pdd_user_search_results a",function(t){t.preventDefault();var n=e(this).data("login");e(".pdd-ajax-user-search").val(n);e(".pdd_user_search_results").html("")})})