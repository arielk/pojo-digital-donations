function pdd_load_gateway(e){jQuery(".pdd-cart-ajax").show();jQuery("#pdd_purchase_form_wrap").html('<img src="'+pdd_scripts.ajax_loader+'"/>');jQuery.post(pdd_scripts.ajaxurl+"?payment-mode="+e,{action:"pdd_load_gateway",pdd_payment_mode:e},function(e){jQuery("#pdd_purchase_form_wrap").html(e);jQuery(".pdd-no-js").hide()})}var pdd_scripts;jQuery(document).ready(function(e){e(".pdd-no-js").hide();e("a.pdd-add-to-cart").addClass("pdd-has-js");e("body").on("click.pddRemoveFromCart",".pdd-remove-from-cart",function(t){var n=e(this),r=n.data("cart-item"),i=n.data("action"),s=n.data("download-id"),o={action:i,cart_item:r};e.ajax({type:"POST",data:o,dataType:"json",url:pdd_scripts.ajaxurl,success:function(t){if(t.removed){if(parseInt(pdd_scripts.position_in_cart,10)===parseInt(r,10)){window.location=window.location;return false}e(".pdd-cart").find("[data-cart-item='"+r+"']").parent().remove();if(e("#pdd_purchase_"+s).length){e("#pdd_purchase_"+s+" .pdd_go_to_checkout").hide();e("#pdd_purchase_"+s+" a.pdd-add-to-cart").show().removeAttr("data-pdd-loading")}e("span.pdd-cart-quantity").each(function(){var t=parseInt(e(this).text(),10)-1;if(t<1){t=0}e(this).text(t);e("body").trigger("pdd_quantity_updated",[t])});e(".cart_item.pdd_subtotal span").html(t.subtotal);if(!e(".pdd-cart-item").length){e(".cart_item.pdd_subtotal,.pdd-cart-number-of-items,.cart_item.pdd_checkout").hide();e(".pdd-cart").append('<li class="cart_item empty">'+pdd_scripts.empty_cart_message+"</li>")}e("body").trigger("pdd_cart_item_removed",[t])}}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}}).done(function(e){});return false});e("body").on("click.pddAddToCart",".pdd-add-to-cart",function(t){t.preventDefault();var n=e(this),r=n.closest("form");if("straight_to_gateway"==r.find(".pdd_action_input").val()){r.submit();return true}var i=n.find(".pdd-loading");var s=n.closest("div");var o=i.width(),u=i.height();n.attr("data-pdd-loading","");i.css({"margin-left":o/-2,"margin-top":u/-2});var r=n.parents("form").last();var a=n.data("download-id");var f=n.data("variable-price");var l=n.data("price-mode");var c=[];if(f=="yes"){if(!e(".pdd_price_option_"+a+":checked",r).length){n.removeAttr("data-pdd-loading");alert(pdd_scripts.select_option);return}e(".pdd_price_option_"+a+":checked",r).each(function(t){c[t]=e(this).val()})}else{c[0]=a}var h=n.data("action");var p={action:h,download_id:a,price_ids:c,post_data:e(r).serialize()};e.ajax({type:"POST",data:p,dataType:"json",url:pdd_scripts.ajaxurl,success:function(t){if(pdd_scripts.redirect_to_checkout=="1"){window.location=pdd_scripts.checkout_page}else{if(e(".cart_item.empty").length){e(t.cart_item).insertBefore(".cart_item.pdd_subtotal");e(".cart_item.pdd_checkout,.cart_item.pdd_subtotal").show();e(".cart_item.empty").remove()}else{e(t.cart_item).insertBefore(".cart_item.pdd_subtotal")}e(".cart_item.pdd_subtotal span").html(t.subtotal);e("span.pdd-cart-quantity").each(function(){var t=parseInt(e(this).text(),10)+1;e(this).text(t);e("body").trigger("pdd_quantity_updated",[t])});if(e(".pdd-cart-number-of-items").css("display")=="none"){e(".pdd-cart-number-of-items").show("slow")}if(f=="no"||l!="multi"){e("a.pdd-add-to-cart",s).toggle();e(".pdd_go_to_checkout",s).css("display","inline-block")}if(l=="multi"){n.removeAttr("data-pdd-loading")}if(e(".pdd_download_purchase_form").length){var r=e('.pdd_download_purchase_form *[data-download-id="'+a+'"]').parents("form");e("a.pdd-add-to-cart",r).hide();e(".pdd_go_to_checkout",r).show().removeAttr("data-pdd-loading")}if(t!="incart"){e(".pdd-cart-added-alert",s).fadeIn();setTimeout(function(){e(".pdd-cart-added-alert",s).fadeOut()},3e3)}e("body").trigger("pdd_cart_item_added",[t])}}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}}).done(function(e){});return false});e("#pdd_checkout_form_wrap").on("click",".pdd_checkout_register_login",function(){var t=e(this),n={action:t.data("action")};e(".pdd-cart-ajax").show();e.post(pdd_scripts.ajaxurl,n,function(t){e("#pdd_checkout_login_register").html(pdd_scripts.loading);e("#pdd_checkout_login_register").html(t);e(".pdd-cart-ajax").hide()});return false});e(document).on("click","#pdd_purchase_form #pdd_login_fields input[type=submit]",function(t){t.preventDefault();var n=e(this).val();e(this).val(pdd_global_vars.purchase_loading);e(this).after('<span class="pdd-cart-ajax"><i class="pdd-icon-spinner pdd-icon-spin"></i></span>');var r={action:"pdd_process_checkout_login",pdd_ajax:1,pdd_user_login:e("#pdd_login_fields #pdd_user_login").val(),pdd_user_pass:e("#pdd_login_fields #pdd_user_pass").val()};e.post(pdd_global_vars.ajaxurl,r,function(t){if(e.trim(t)=="success"){e(".pdd_errors").remove();window.location=pdd_scripts.checkout_page}else{e("#pdd_login_fields input[type=submit]").val(n);e(".pdd-cart-ajax").remove();e(".pdd_errors").remove();e("#pdd-user-login-submit").before(t)}})});e("select#pdd-gateway, input.pdd-gateway").change(function(t){var n=e("#pdd-gateway option:selected, input.pdd-gateway:checked").val();if(n=="0")return false;pdd_load_gateway(n);return false});if(pdd_scripts.is_checkout=="1"&&e("select#pdd-gateway, input.pdd-gateway").length){setTimeout(function(){pdd_load_gateway(pdd_scripts.default_gateway)},200)}e(document).on("click","#pdd_purchase_form #pdd_purchase_submit input[type=submit]",function(t){t.preventDefault();var n=e(this).val();e(this).val(pdd_global_vars.purchase_loading);e(this).after('<span class="pdd-cart-ajax"><i class="pdd-icon-spinner pdd-icon-spin"></i></span>');e.post(pdd_global_vars.ajaxurl,e("#pdd_purchase_form").serialize()+"&action=pdd_process_checkout&pdd_ajax=true",function(t){if(e.trim(t)=="success"){e(".pdd_errors").remove();e("#pdd_purchase_form").submit()}else{e("#pdd_purchase_form #pdd-purchase-button").val(n);e(".pdd-cart-ajax").remove();e(".pdd_errors").remove();e("#pdd_purchase_submit").before(t)}})})})